id: "01_fetch_planner"
name: "Fetch Planner"
description: "取得タスクを計画する"
pipeline: "A"
system_prompt: "{{common_system_prompt}}"
user_prompt: |
  入力:
  patent_case:
  {{patent_case}}

  poll_state:
  {{poll_state}}

  quota_remaining:
  {{quota_remaining}}

  today:
  {{today}}

  あなたの仕事:
  - 今日実行する取得タスクを tasks に列挙する。
  - quota_remaining を超えない。
  - まず軽い変化検知（経過情報系）を優先し、変化がありそうな場合のみ深い取得（書類、引用など）を優先度高で入れる方針にする。
  - 同一内容の重複取得は避ける（dedupe_keyで表現）。

  api_type は次のいずれかを使う:
  - status_simple
  - status_full
  - grant_info
  - citations
  - number_reference
  - documents_dispatch
  - documents_application
  - documents_office_action

  出力は次のJSONスキーマに厳密に従う:
  {
    "tasks": [
      {
        "api_type": "status_simple",
        "identifier": { "type": "application|publication|grant|pct", "value": "string" },
        "priority": 0,
        "scheduled_at": "YYYY-MM-DDTHH:MM:SSZ",
        "dedupe_key": "string",
        "reason": "string"
      }
    ],
    "deferred": [
      {
        "api_type": "string",
        "identifier": { "type": "string", "value": "string" },
        "priority": 0,
        "defer_to_date": "YYYY-MM-DD",
        "reason": "string"
      }
    ],
    "notes": ["string"]
  }
output_schema:
  type: object
  properties:
    tasks:
      type: array
    deferred:
      type: array
    notes:
      type: array
